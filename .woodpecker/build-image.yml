steps:
  docker:
    image: plugins/kaniko
    settings:
      username: jcm
      password:
        from_secret: gitea_package_token
      repo: git.jcm.re/jcm/xmbshell
      registry: git.jcm.re
      tags: build
      snapshot-mode: redo
      context: .woodpecker
      dockerfile: .woodpecker/build.Dockerfile
    when:
      - event: cron
        cron: update_dockerfiles

when:
  - path: ".woodpecker/build-image.yml"
  - path: ".woodpecker/build.Dockerfile"
